{% extends "base.html" %}
{% block content %}

<style>
  .rarity-basic { color: #9e9e9e; }        /* gris */
  .rarity-uncommon { color: #4caf50; }     /* verde */
  .rarity-special { color: #2196f3; }      /* azul */
  .rarity-epic { color: #9c27b0; }         /* morado */
  .rarity-legendary { color: #ffeb3b; font-weight: bold; }  /* amarillo */
  .rarity-mythic { color: #f44336; font-weight: bold; }     /* rojo */
  .rarity-ascended { color: #e91e63; font-weight: bold; }   /* rosado */
</style>

<h2 class="fw-bold mb-3">üëë Tienda VIP</h2>

<div class="d-flex flex-wrap gap-2 mb-3">
  <a href="{% url 'rpg_hub' %}" class="btn btn-outline-secondary btn-sm rounded-pill">
    ‚Üê Volver al hub RPG
  </a>
</div>

<div class="row mb-3">
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body py-2">
        <p class="mb-1" style="font-size: 0.9rem;">
          Monedas: <strong>{{ profile.coins }}</strong> &nbsp;|&nbsp;
          Rub√≠es: <strong>{{ profile.rubies }}</strong>
        </p>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body py-2">
        <div class="d-flex justify-content-end gap-2">
          <a href="?type=all" class="btn btn-sm {% if filter_type == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            Todo
          </a>
          <a href="?type=items" class="btn btn-sm {% if filter_type == 'items' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            Solo objetos
          </a>
          <a href="?type=rubies" class="btn btn-sm {% if filter_type == 'rubies' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            Solo rub√≠es
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

{% if offers %}
<div class="row g-3">
  {% for offer in offers %}
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">

          {% if offer.offer_type == "item" and offer.item %}
            <h5 class="fw-bold mb-1">
              <span class="rarity-{{ offer.item.rarity }}">
                {{ offer.item.name }}
              </span>
            </h5>
            <p class="mb-1">
              Tipo: {{ offer.item.get_slot_display }}
            </p>
            <p class="mb-1" style="font-size: 0.85rem;">
              ATK {{ offer.item.attack }} |
              DEF {{ offer.item.defense }} |
              HP {{ offer.item.hp }}<br>
              CRIT {{ offer.item.crit_chance }}% |
              ESQ {{ offer.item.dodge_chance }}% |
              VEL {{ offer.item.speed }}
            </p>
          {% elif offer.offer_type == "rubies" %}
            <h5 class="fw-bold mb-1">üíé Paquete de rub√≠es</h5>
            <p class="mb-1">
              Cantidad: <strong>{{ offer.ruby_amount }}</strong> rub√≠(es)
            </p>
          {% endif %}

          <hr class="my-2">

          <p class="mb-1">
            {% if offer.price_coins > 0 %}
              üí∞ <strong>{{ offer.price_coins }}</strong> monedas
            {% endif %}
            {% if offer.price_rubies > 0 %}
              {% if offer.price_coins > 0 %} + {% endif %}
              üíé <strong>{{ offer.price_rubies }}</strong> rub√≠(es)
            {% endif %}
          </p>

          <p class="mb-2 text-muted" style="font-size: 0.8rem;">
            Oferta creada por: {{ offer.created_by.username }}
          </p>

          <div class="mt-auto">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="action" value="buy">
              <input type="hidden" name="offer_id" value="{{ offer.id }}">
              <button type="submit" class="btn btn-sm btn-success w-100">
                Comprar
              </button>
            </form>
          </div>

        </div>
      </div>
    </div>
  {% endfor %}
</div>
{% else %}
  <p class="text-muted">No hay ofertas VIP disponibles por ahora.</p>
{% endif %}

{% endblock %}
