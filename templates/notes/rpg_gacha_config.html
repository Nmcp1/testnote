{% extends "base.html" %}
{% block content %}

<style>
  .rarity-basic { color: #9e9e9e; }
  .rarity-uncommon { color: #4caf50; }
  .rarity-special { color: #2196f3; }
  .rarity-epic { color: #9c27b0; }
  .rarity-legendary { color: #ffeb3b; font-weight: bold; }
  .rarity-mythic { color: #f44336; font-weight: bold; }
  .rarity-ascended { color: #e91e63; font-weight: bold; }
</style>

<h2 class="fw-bold mb-3">
  Configuración de Probabilidades — Gacha
</h2>

<div class="mb-3">
  <ul class="nav nav-pills">
    <li class="nav-item">
      <a class="nav-link {% if gacha_type == 'normal' %}active{% endif %}"
         href="{% url 'rpg_gacha_config' %}">
        Normal
      </a>
    </li>

    <li class="nav-item">
      <a class="nav-link {% if gacha_type == 'premium' %}active{% endif %}"
         href="{% url 'rpg_gacha_premium_config' %}">
        Premium
      </a>
    </li>
  </ul>
</div>

<div class="card shadow-sm">
  <div class="card-body">

    {% if gacha_type == 'normal' %}
      <h5 class="card-title mb-3">Gacha Normal</h5>
      <p class="text-muted" style="font-size:0.9rem;">
        Ajusta las probabilidades de cada rareza (0–1).
        La suma total no debe superar <strong>1.0</strong>.
      </p>
    {% else %}
      <h5 class="card-title mb-3">Gacha Premium</h5>
      <p class="text-muted" style="font-size:0.9rem;">
        Ajusta las probabilidades de cada rareza (0–1).
        La suma total no debe superar <strong>1.0</strong>.<br>
        La probabilidad restante será utilizada como probabilidad de
        <strong>+1 rubí</strong>.
      </p>
    {% endif %}

    <!-- FORMULARIO -->
    <form method="post"
          action="{% if gacha_type == 'normal' %}
                     {% url 'rpg_gacha_config' %}
                   {% else %}
                     {% url 'rpg_gacha_premium_config' %}
                   {% endif %}">
      {% csrf_token %}

      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Rareza</th>
              <th style="width: 220px;">Probabilidad (0–1)</th>
              <th>Actual</th>
            </tr>
          </thead>
          <tbody>
            {% for row in rows %}
              <tr>
                <td>
                  <span class="rarity-{{ row.code }}">
                    {{ row.label }}
                  </span>
                </td>

                <td>
                  <input type="number"
                         class="form-control form-control-sm"
                         name="prob_{{ row.code }}"
                         min="0"
                         max="1"
                         step="0.000001"
                         value="{{ row.prob|floatformat:6 }}">
                </td>

                <td>
                  {{ row.prob|floatformat:6 }}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if ruby_prob is not None %}
        <p class="mt-2 mb-2">
          Probabilidad restante para <strong>+1 rubí</strong>:
          <code>{{ ruby_prob|floatformat:6 }}</code>
        </p>
      {% endif %}

      <button type="submit" class="btn btn-primary mt-2">
        Guardar Probabilidades
      </button>

    </form>

  </div>
</div>

{% endblock %}
