{% extends "base.html" %}
{% block content %}

<h2 class="fw-bold mb-3">RPG — Gacha ⭐</h2>

<div class="d-flex flex-wrap gap-2 mb-3">
  <a href="{% url 'rpg_hub' %}" class="btn btn-outline-secondary btn-sm rounded-pill">
    ← Volver al hub
  </a>
</div>

<div class="row g-3">
  <!-- Columna izquierda: Gacha -->
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="fw-bold mb-3">Tirar Gacha</h5>

        <p class="mb-2" style="font-size: 0.9rem;">
          Monedas actuales: <strong>{{ profile.coins }}</strong>
        </p>
        <p class="mb-3 text-muted" style="font-size: 0.85rem;">
          Cada tirada cuesta <strong>15 monedas</strong>.
        </p>

        <form method="post" class="mb-3">
          {% csrf_token %}
          <div class="mb-3">
            <label for="slot" class="form-label">Tipo de equipamiento:</label>
            <select name="slot" id="slot" class="form-select">
              <option value="weapon" {% if selected_slot == "weapon" %}selected{% endif %}>Arma</option>
              <option value="helmet" {% if selected_slot == "helmet" %}selected{% endif %}>Casco</option>
              <option value="armor" {% if selected_slot == "armor" %}selected{% endif %}>Armadura</option>
              <option value="pants" {% if selected_slot == "pants" %}selected{% endif %}>Pantalones</option>
              <option value="boots" {% if selected_slot == "boots" %}selected{% endif %}>Botas</option>
              <option value="shield" {% if selected_slot == "shield" %}selected{% endif %}>Escudo</option>
              <option value="amulet" {% if selected_slot == "amulet" %}selected{% endif %}>Amuleto</option>
            </select>
          </div>

          <button type="submit" class="btn btn-primary">
            Tirar gacha
          </button>
        </form>

        {% if rolled_item %}
          <hr>
          <h6 class="fw-bold">Resultado de la última tirada</h6>
          <p class="mb-1">
            Obtuviste: <strong>{{ rolled_item.name }}</strong>
          </p>
          <p class="mb-1" style="font-size: 0.9rem;">
            ATK {{ rolled_item.attack }} |
            DEF {{ rolled_item.defense }} |
            HP {{ rolled_item.hp }} |
            CRIT {{ rolled_item.crit_chance }}% |
            ESQ {{ rolled_item.dodge_chance }}% |
            VEL {{ rolled_item.speed }}
          </p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Columna derecha: Probabilidades -->
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="fw-bold mb-3">Probabilidades del Gacha</h5>

        {% if probabilities %}
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Rareza</th>
                <th>Probabilidad</th>
              </tr>
            </thead>
            <tbody>
              {% for row in probabilities %}
              <tr>
                <td>{{ row.label }}</td>
                <td>{{ row.percent|floatformat:4 }}%</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="text-muted mb-0">
            No hay probabilidades configuradas.
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
