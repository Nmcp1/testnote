{% extends "base.html" %}

{% block content %}
<style>
  :root{
    --bg: #0b0f14;
    --panel: #0f1620;
    --border: rgba(255,255,255,0.10);
    --text: #fff;
    --muted: rgba(255,255,255,0.7);
    --accent: #4cc9f0;
    --good: #3ddc84;
    --warn: #ffcc00;
  }

  .hub-wrap{
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 18px;
    color: var(--text);
    box-shadow: 0 10px 30px rgba(0,0,0,0.35);
  }

  .pill{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.04);
    color: var(--text);
    font-weight: 900;
  }
  .muted{ color: var(--muted); font-weight: 800; }

  .hub-top{
    display:flex;
    justify-content: space-between;
    align-items:center;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 14px;
  }

  .panel{
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 14px;
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  @media (max-width: 992px){
    .grid{ grid-template-columns: 1fr; }
  }

  .lobby-row{
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.04);
    margin-bottom: 10px;
  }

  .lobby-code{ font-weight: 900; }
  .lobby-meta{ color: var(--muted); font-weight: 800; font-size: 12px; }

  .btnx{ border-radius: 12px; font-weight: 900; }

  .top-row{
    display:flex;
    justify-content: space-between;
    align-items:flex-start;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.04);
    margin-bottom: 10px;
  }

  .rank{
    font-weight: 900;
    color: var(--warn);
    min-width: 36px;
  }

  .team{
    font-weight: 900;
  }

  .score{
    font-weight: 900;
    color: var(--accent);
  }
</style>

<div class="hub-wrap">
  <div class="hub-top">
    <div>
      <h4 style="font-weight: 900; margin:0;">üß≠ Expediciones</h4>
      <div class="muted">Top diario y cap de oro por d√≠a.</div>
    </div>

    <div class="d-flex gap-2 flex-wrap">
      <span class="pill">ü™ô Diario: <span class="muted">{{ earned_today }}/{{ daily_cap }}</span></span>
      <span class="pill">üßæ Total: <span class="muted">{{ total_coins }}</span></span>

      <a class="btn btn-success btnx" href="{% url 'expeditions_create' %}">‚ûï Crear Lobby</a>
      <a class="btn btn-outline-light btnx" href="{% url 'home' %}">‚Üê Inicio</a>
    </div>
  </div>

  <div class="grid">
    <!-- Lobbies -->
    <div class="panel">
      <h5 style="font-weight:900;">üìã Lobbies</h5>

      {% if lobbies %}
        {% for l in lobbies %}
          <div class="lobby-row">
            <div>
              <div class="lobby-code">üîë {{ l.code }} ‚Äî #{{ l.id }}</div>
              <div class="lobby-meta">
                Estado: {{ l.get_status_display }} ‚Ä¢ Fase: {{ l.get_phase_display }} ‚Ä¢ Piso: {{ l.floor }}
                ‚Ä¢ Jugadores: {{ l.participants.count }}/3
              </div>
            </div>
            <div class="d-flex gap-2 flex-wrap">
              {% if l.participants.count < 3 and l.status == "waiting" %}
                <a class="btn btn-primary btnx" href="{% url 'expeditions_join' l.id %}">Unirse</a>
              {% else %}
                <a class="btn btn-outline-secondary btnx disabled" href="#">No disponible</a>
              {% endif %}
              <a class="btn btn-outline-light btnx" href="{% url 'expeditions_lobby' l.id %}">Ver</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="text-center" style="color: var(--muted); font-weight:800; padding: 20px;">
          No hay lobbies todav√≠a. Crea uno y empieza.
        </div>
      {% endif %}
    </div>

    <!-- Top Diario -->
    <div class="panel">
      <div class="d-flex justify-content-between align-items-center">
        <h5 style="font-weight:900; margin:0;">üèÜ Top diario ({{ top_day }})</h5>
        <a class="btn btn-outline-light btnx" href="{% url 'expeditions_daily_top' %}">Ver completo</a>
      </div>
      <div class="muted" style="margin-top:6px;">
        Recompensa a las 00:00 (Chile): 1¬∞ 600 ‚Ä¢ 2¬∞ 400 ‚Ä¢ 3¬∞ 200 (si repites, recibes solo la mayor).
      </div>

      <div style="margin-top:12px;">
        {% if top_daily %}
          {% for t in top_daily %}
            <div class="top-row">
              <div class="rank">#{{ t.rank }}</div>
              <div style="flex:1;">
                <div class="team">üë• {{ t.members|join:", " }}</div>
                <div class="muted">Lobby #{{ t.lobby_id }}</div>
              </div>
              <div class="score">Piso {{ t.floor }}</div>
            </div>
          {% endfor %}
        {% else %}
          <div class="text-center" style="color: var(--muted); font-weight:800; padding: 20px;">
            Todav√≠a no hay runs hoy.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
